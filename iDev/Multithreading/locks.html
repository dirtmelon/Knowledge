<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Locks - Knowledge</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../About.html">å…³äº</a></li><li class="chapter-item expanded "><a href="../../programming-languages/programming-languages.html">ç¼–ç¨‹è¯­è¨€</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../programming-languages/Swift/Swift.html">Swift</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Objective-C.html">Objective-C</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Objective-C.html">Runtime</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/associated-objects.html">Associated Objects</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/initialize.html">initialize</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/load.html">load</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Block.html">Block</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Category.html">Category</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Message-Sending-And-Forwarding.html">Message Sending And Forwarding</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/KVO.html">KVO</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/KVC.html">KVC</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/AutoreleasePool.html">AutoreleasePool</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/dealloc.html">dealloc</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Tagged-Pointer.html">Tagged Pointer</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/weak.html">weak</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Object.html">Object</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/reference-counting.html">Reference Counting</a></li></ol></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/Objective-C.html">Tips</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/getting-subclasses-of-objective-c-class.html">å¦‚ä½•è·å–æŸä¸ªç±»çš„å…¨éƒ¨å­ç±»</a></li><li class="chapter-item expanded "><a href="../../programming-languages/Objective-C/objective-c-class-properties.html">Objective-C ç±»å±æ€§</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../iDev/iDev.html">iDev</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../iDev/Multithreading/Introduction.html">å¤šçº¿ç¨‹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../iDev/Multithreading/NSOperation.html">NSOperation</a></li><li class="chapter-item expanded "><a href="../../iDev/Multithreading/Grand-Central-Dispatch.html">Grand Central Dispatch</a></li><li class="chapter-item expanded "><a href="../../iDev/Multithreading/thread.html">pthread å’Œ NSThread</a></li><li class="chapter-item expanded "><a href="../../iDev/Multithreading/locks.html" class="active">Locks</a></li><li class="chapter-item expanded "><a href="../../iDev/Multithreading/RunLoop.html">RunLoop</a></li></ol></li><li class="chapter-item expanded "><a href="../../iDev/UIKit/UIKit.html">UIKit</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../iDev/UIKit/touches_presses_and_gestures.html">ç‚¹å‡»ï¼ŒæŒ‰å‹ä¸æ‰‹åŠ¿</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../books/books.html">é˜…è¯»</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../books/Homo-Deus-A-Brief-History-of-Tomorrow.html">æœªæ¥ç®€å²</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Knowledge</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/dirtmelon/Knowledge" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="é”"><a class="header" href="#é”">é”</a></h1>
<h2 id="è‡ªæ—‹é”"><a class="header" href="#è‡ªæ—‹é”">è‡ªæ—‹é”</a></h2>
<p>å½“çº¿ç¨‹ç­‰å¾…è‡ªæ—‹é”æ—¶ä¸ä¼šè¿›å…¥ç¡çœ ï¼Œè‡ªæ—‹é”ç”±äºåœ¨è·å–é”æ—¶ï¼Œçº¿ç¨‹ä¼šä¸€ç›´å¤„äºå¿™ç­‰çŠ¶æ€ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆä»»åŠ¡çš„ä¼˜å…ˆçº§åè½¬ã€‚</p>
<h3 id="osspinlock"><a class="header" href="#osspinlock">OSSpinLock</a></h3>
<blockquote>
<p>æ–°ç‰ˆÂ iOSÂ ä¸­ï¼Œç³»ç»Ÿç»´æŠ¤äº†Â 5Â ä¸ªä¸åŒçš„çº¿ç¨‹ä¼˜å…ˆçº§/QoS: backgroundï¼Œutilityï¼Œdefaultï¼Œuser-initiatedï¼Œuser-interactiveã€‚é«˜ä¼˜å…ˆçº§çº¿ç¨‹å§‹ç»ˆä¼šåœ¨ä½ä¼˜å…ˆçº§çº¿ç¨‹å‰æ‰§è¡Œï¼Œä¸€ä¸ªçº¿ç¨‹ä¸ä¼šå—åˆ°æ¯”å®ƒæ›´ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„å¹²æ‰°ã€‚è¿™ç§çº¿ç¨‹è°ƒåº¦ç®—æ³•ä¼šäº§ç”Ÿæ½œåœ¨çš„ä¼˜å…ˆçº§åè½¬é—®é¢˜ï¼Œä»è€Œç ´åäº†Â spin lockã€‚</p>
</blockquote>
<blockquote>
<p>å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªä½ä¼˜å…ˆçº§çš„çº¿ç¨‹è·å¾—é”å¹¶è®¿é—®å…±äº«èµ„æºï¼Œè¿™æ—¶ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¹Ÿå°è¯•è·å¾—è¿™ä¸ªé”ï¼Œå®ƒä¼šå¤„äºÂ spin lockÂ çš„å¿™ç­‰çŠ¶æ€ä»è€Œå ç”¨å¤§é‡Â CPUã€‚æ­¤æ—¶ä½ä¼˜å…ˆçº§çº¿ç¨‹æ— æ³•ä¸é«˜ä¼˜å…ˆçº§çº¿ç¨‹äº‰å¤ºÂ CPUÂ æ—¶é—´ï¼Œä»è€Œå¯¼è‡´ä»»åŠ¡è¿Ÿè¿Ÿå®Œä¸æˆã€æ— æ³•é‡Šæ”¾Â lockã€‚è¿™å¹¶ä¸åªæ˜¯ç†è®ºä¸Šçš„é—®é¢˜ï¼ŒlibobjcÂ å·²ç»é‡åˆ°äº†å¾ˆå¤šæ¬¡è¿™ä¸ªé—®é¢˜äº†ï¼Œäºæ˜¯è‹¹æœçš„å·¥ç¨‹å¸ˆåœç”¨äº†Â OSSpinLockã€‚</p>
</blockquote>
<p><a href="https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/">ä¸å†å®‰å…¨çš„ OSSpinLock</a></p>
<h2 id="äº’æ–¥é”"><a class="header" href="#äº’æ–¥é”">äº’æ–¥é”</a></h2>
<p>å½“ç­‰å¾…äº’æ–¥é”æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥ç¡çœ ï¼Œé”é‡Šæ”¾æ—¶å°±ä¼šå”¤é†’çº¿ç¨‹ã€‚äº’æ–¥é”åˆåˆ†ä¸ºé€’å½’é”å’Œéé€’å½’é”ï¼š</p>
<ul>
<li>é€’å½’é”ï¼šå¯é‡å…¥ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨é”é‡Šæ”¾å‰å¯å†æ¬¡è·å–é”ï¼Œå¯ä»¥é€’å½’è°ƒç”¨ï¼›</li>
<li>éé€’å½’é”ï¼šä¸å¯é‡å…¥ï¼Œå¿…é¡»ç­‰é”é‡Šæ”¾åæ‰èƒ½å†æ¬¡è·å–ã€‚</li>
</ul>
<h3 id="pthread_mutex"><a class="header" href="#pthread_mutex">pthread_mutex</a></h3>
<p><code>pthread_mutex</code> æ˜¯äº’æ–¥é”ï¼Œå¯¹æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯å¯ä»¥ä½¿ç”¨ï¼Œ API æ¯”è¾ƒç®€å•ï¼š</p>
<pre><code class="language-objectivec">// å¯¼å…¥å¤´æ–‡ä»¶
#import &lt;pthread.h&gt;
// å…¨å±€å£°æ˜äº’æ–¥é”
pthread_mutex_t _lock;
// åˆå§‹åŒ–äº’æ–¥é”
pthread_mutex_init(&amp;_lock, NULL);
// åŠ é”
pthread_mutex_lock(&amp;_lock);
// è¿™é‡Œåšéœ€è¦çº¿ç¨‹å®‰å…¨æ“ä½œ

// è§£é”
pthread_mutex_unlock(&amp;_lock);
// é‡Šæ”¾é”
pthread_mutex_destroy(&amp;_lock);

</code></pre>
<h3 id="synchronized"><a class="header" href="#synchronized">@synchronized</a></h3>
<p><a href="https://www.mikeash.com/pyblog/friday-qa-2015-02-20-lets-build-synchronized.html">mikeash.com: Friday Q&amp;A 2015-02-20: Let's Build @synchronized</a></p>
<p><a href="http://yulingtianxia.com/blog/2015/11/01/More-than-you-want-to-know-about-synchronized/">å…³äº @synchronizedï¼Œè¿™å„¿æ¯”ä½ æƒ³çŸ¥é“çš„è¿˜è¦å¤š</a></p>
<p>æ€§èƒ½æ¯”è¾ƒä½ï¼Œå› ä¸ºæœ‰å®¹é”™å¤„ç†ï¼Œå’Œä½¿ç”¨å…¨å±€è¡¨ã€‚</p>
<ol>
<li>ä¸èƒ½ä½¿ç”¨<code>éOCå¯¹è±¡</code>ä½œä¸ºåŠ é”æ¡ä»¶â€”â€”<code>id2data</code>ä¸­æ¥æ”¶å‚æ•°ä¸ºidç±»å‹</li>
<li>å¤šæ¬¡é”åŒä¸€ä¸ªå¯¹è±¡ä¼šæœ‰ä»€ä¹ˆåæœå—â€”â€”ä¼šä»é«˜é€Ÿç¼“å­˜ä¸­æ‹¿åˆ°dataï¼Œæ‰€ä»¥åªä¼šé”ä¸€æ¬¡å¯¹è±¡</li>
<li>éƒ½è¯´@synchronizedæ€§èƒ½ä½â€”â€”æ˜¯å› ä¸ºåœ¨åº•å±‚<code>å¢åˆ æ”¹æŸ¥</code>æ¶ˆè€—äº†å¤§é‡æ€§èƒ½</li>
<li>åŠ é”å¯¹è±¡ä¸èƒ½ä¸ºnilï¼Œå¦åˆ™åŠ é”æ— æ•ˆï¼Œä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ol>
<h3 id="nslock"><a class="header" href="#nslock">NSLock</a></h3>
<p><code>NSLock</code> å¯¹ <code>pthread_mutex</code> è¿›è¡Œäº†ä¸€å±‚å°è£…ï¼Œæä¾›äº† <code>Objective-C</code> å±‚çº§çš„ API ï¼š</p>
<pre><code class="language-objectivec">NSLock *lock = [[NSLock alloc] init]
[lock lock];
[lock unlock];
</code></pre>
<p>ä» Swift å¼€æºç‰ˆçš„ Foundation ä¸­å¯ä»¥çœ‹åˆ° NSLock æ˜¯åŸºäº <code>pthread_mutex</code> çš„å°è£…ï¼š</p>
<p><a href="https://github.com/apple/swift-corelibs-foundation/blob/main/Sources/Foundation/NSLock.swift">NSLock.swift</a></p>
<p>åˆ é™¤å…¶å®ƒå¹³å°çš„ä»£ç åå¤§æ¦‚å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="language-swift">open class NSLock: NSObject, NSLocking {
		public override init() {
        pthread_mutex_init(mutex, nil)
        pthread_cond_init(timeoutCond, nil)
        pthread_mutex_init(timeoutMutex, nil)
    }

		open func lock() {
        pthread_mutex_lock(mutex)
    }

    open func unlock() {
        pthread_mutex_unlock(mutex)
        // Wakeup any threads waiting in lock(before:)
        pthread_mutex_lock(timeoutMutex)
        pthread_cond_broadcast(timeoutCond)
        pthread_mutex_unlock(timeoutMutex)
    }
}
extension NSLock {
    // åŒæ­¥æ‰§è¡Œ closure æ“ä½œ
    internal func synchronized&lt;T&gt;(_ closure: () -&gt; T) -&gt; T {
        self.lock()
        defer { self.unlock() }
        return closure()
    }
}

</code></pre>
<p>è€Œ <code>NSLock</code> éé€’å½’é”ï¼Œåœ¨é€’å½’è°ƒç”¨æ—¶ä¼šå µå¡ã€‚å¦‚æœéœ€è¦é€’å½’è°ƒç”¨å¯ä»¥é€šè¿‡ <code>NSRecursiveLock</code> åŠ é”ï¼Œ <code>NSRecursiveLock</code> å®ç°ä¸ <code>NSLock</code> ç±»ä¼¼ï¼Œåªæ˜¯åœ¨åˆå§‹åŒ–æ—¶è®¾ç½® <code>mutex</code> ä¸º <code>RECURSIVE</code> ç±»å‹ï¼š</p>
<pre><code class="language-swift">open class NSRecursiveLock: NSObject, NSLocking {
    internal var mutex = _RecursiveMutexPointer.allocate(capacity: 1)
    private var timeoutCond = _ConditionVariablePointer.allocate(capacity: 1)
    private var timeoutMutex = _MutexPointer.allocate(capacity: 1)

    public override init() {
        super.init()
        var attrib = pthread_mutexattr_t()
        withUnsafeMutablePointer(to: &amp;attrib) { attrs in
            pthread_mutexattr_init(attrs)
						// è®¾ç½®ä¸º RECURSIVE
            pthread_mutexattr_settype(attrs, Int32(PTHREAD_MUTEX_RECURSIVE))
            pthread_mutex_init(mutex, attrs)
        }
        pthread_cond_init(timeoutCond, nil)
        pthread_mutex_init(timeoutMutex, nil)
    }

    open func lock() {
        pthread_mutex_lock(mutex)
    }

    open func unlock() {
        pthread_mutex_unlock(mutex)
        // Wakeup any threads waiting in lock(before:)
        pthread_mutex_lock(timeoutMutex)
        pthread_cond_broadcast(timeoutCond)
        pthread_mutex_unlock(timeoutMutex)
    }
}

</code></pre>
<p>è€Œé€’å½’é”åŒæ—¶å¯¹åŒä¸€ä¸ªå¯¹è±¡ä½¿ç”¨é”æ—¶ä¹Ÿä¼šäº§ç”Ÿæ­»é”ï¼š</p>
<h3 id="nscondition"><a class="header" href="#nscondition">NSCondition</a></h3>
<p><a href="https://developer.apple.com/documentation/foundation/nscondition">NSCondition</a></p>
<p><code>NSCondition</code> å¯¹è±¡åœ¨ç»™å®šçº¿ç¨‹ä¸­å……å½“é”å’Œæ£€æŸ¥ç‚¹ ï¼ˆ checkpoint ï¼‰ã€‚é”åœ¨æ£€æµ‹æ¡ä»¶å’Œæ‰§è¡Œç”±æ¡ä»¶è§¦å‘çš„ä»»åŠ¡æ—¶ä¿æŠ¤ä½ çš„ä»£ç ã€‚æ£€æŸ¥ç‚¹åˆ™è¦æ±‚çº¿ç¨‹åœ¨æ‰§è¡Œå…¶ä»»åŠ¡ä¹‹å‰æ¡ä»¶ä¸º <code>true</code> ã€‚å½“æ¡ä»¶ä¸º <code>false</code> æ—¶ï¼Œçº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹å‘æ¡ä»¶å¯¹è±¡å‘å‡ºä¿¡å·ã€‚ä¼ªä»£ç ï¼š</p>
<pre><code>lock the condition
while (!(boolean_predicate)) {
    wait on condition
}
do protected work
(optionally, signal or broadcast the condition again or change a predicate value)
unlock the condition

</code></pre>
<p>ä¸ä¿¡å·é‡ç±»ä¼¼ï¼Œ Swift æºç ä¸­ä¹Ÿæœ‰ <code>NSCondition</code> çš„å®ç°ï¼š</p>
<pre><code class="language-swift">open class NSCondition: NSObject, NSLocking {
    internal var mutex = _MutexPointer.allocate(capacity: 1)
    internal var cond = _ConditionVariablePointer.allocate(capacity: 1)

    public override init() {
        pthread_mutex_init(mutex, nil)
        pthread_cond_init(cond, nil)
    }

    deinit {
        pthread_mutex_destroy(mutex)
        pthread_cond_destroy(cond)
        mutex.deinitialize(count: 1)
        cond.deinitialize(count: 1)
        mutex.deallocate()
        cond.deallocate()
    }

    open func lock() {
        pthread_mutex_lock(mutex)
    }

    open func unlock() {
        pthread_mutex_unlock(mutex)
    }

    open func wait() {
        pthread_cond_wait(cond, mutex)
    }

    open func wait(until limit: Date) -&gt; Bool {
        guard var timeout = timeSpecFrom(date: limit) else {
            return false
        }
        return pthread_cond_timedwait(cond, mutex, &amp;timeout) == 0
    }

    open func signal() {
        pthread_cond_signal(cond)
    }

    open func broadcast() {
        pthread_cond_broadcast(cond)
    }

    open var name: String?
}

</code></pre>
<p>ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-swift">let cond = NSCondition()
var available = false
var SharedString = &quot;&quot;

class WriterThread : Thread {

    override func main(){
        for _ in 0..&lt;5 {
            cond.lock()
            SharedString = &quot;ğŸ˜…&quot;
            available = true
            cond.signal() // é€šçŸ¥å¹¶ä¸”å”¤é†’ç­‰å¾…çš„çº¿ç¨‹
            cond.unlock()
        }
    }
}

class PrinterThread : Thread {

    override func main(){
        for _ in 0..&lt;5 { // å¾ªç¯ 5 æ¬¡
            cond.lock()
            while(!available){   // é€šè¿‡ä¼ªä¿¡å·è¿›è¡Œä¿æŠ¤
                cond.wait()
            }
            print(SharedString)
            SharedString = &quot;&quot;
            available = false
            cond.unlock()
        }
    }
}

let writet = WriterThread()
let printt = PrinterThread()
printt.start()
writet.start()

</code></pre>
<h3 id="nsconditionlock"><a class="header" href="#nsconditionlock">NSConditionLock</a></h3>
<p><a href="https://developer.apple.com/documentation/foundation/nsconditionlock">NSConditionLock</a></p>
<p><code>NSConditionLock</code> ä¸ <code>NSCondition</code> ä¸åŒï¼Œè‡ªå¸¦æ”¯æŒå¤æ‚çš„æ¡ä»¶é”ï¼Œæ¯”å¦‚è¯´ï¼šæ¶ˆè´¹è€…-æä¾›è€…åœºæ™¯ã€‚ <code>lock(whenCondition:)</code> åœ¨æ¡ä»¶æˆç«‹æ—¶å¯ä»¥è·å–åˆ°é”ï¼Œæˆ–è€…ç­‰å¾…å¦å¤–ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code>unlock(withCondition:)</code> é‡Šæ”¾é”å’Œè®¾ç½®å¯¹åº”çš„å€¼ã€‚</p>
<pre><code class="language-swift">let NO_DATA = 1
let GOT_DATA = 2
let clock = NSConditionLock(condition: NO_DATA)
var SharedInt = 0

class ProducerThread : Thread {

    override func main(){
        for i in 0..&lt;5 {
            clock.lock(whenCondition: NO_DATA) //å½“æ¡ä»¶ä¸º NO_DATA è·å–è¯¥é”
              // å¦‚æœä¸æƒ³ç­‰å¾…æ¶ˆè´¹è€…ï¼Œç›´æ¥è°ƒç”¨ clock.lock() å³å¯
            SharedInt = i
            clock.unlock(withCondition: GOT_DATA) //è§£é”å¹¶è®¾ç½®æ¡ä»¶ä¸º GOT_DATA
        }
    }
}

class ConsumerThread : Thread {

    override func main(){
        for i in 0..&lt;5 {
            clock.lock(whenCondition: GOT_DATA) // å½“æ¡ä»¶ä¸º GOT_DATA è·å–è¯¥é”
            print(i)
            clock.unlock(withCondition: NO_DATA) //è§£é”å¹¶è®¾ç½®æ¡ä»¶ä¸º NO_DATA
        }
    }
}

let pt = ProducerThread()
let ct = ConsumerThread()
ct.start()
pt.start()

</code></pre>
<h3 id="dispatch_semaphore"><a class="header" href="#dispatch_semaphore">dispatch_semaphore</a></h3>
<p><a href="https://developer.apple.com/documentation/dispatch/dispatchsemaphore">dispatch_semaphore</a></p>
<p><code>distpatch_semaphore</code> åœ¨ Swift ä¸Šå·²æ›¿æ¢ä¸º <code>DispatchSemaphore</code> ï¼Œç›¸åº”çš„ API ä¹Ÿæœ‰æ‰€æ”¹å˜ã€‚</p>
<p>ä¿¡å·é‡ï¼Œå¯ä»¥ä½œä¸ºåŒæ­¥é”ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ§åˆ¶ GCD çš„æœ€å¤§å¹¶å‘æ•°ï¼š</p>
<pre><code>let semaphore = DispatchSemaphore(value: 0)
semaphore.signal()
semaphore.wait()

</code></pre>
<h3 id="os_unfair_lock"><a class="header" href="#os_unfair_lock">os_unfair_lock</a></h3>
<p><code>os_unfair_lock</code> æ˜¯è‹¹æœåœ¨ iOS 10/macOS 10.12 ä¸Šæä¾›çš„ï¼Œç”¨äºæ›¿æ¢ <code>OSSpinLock</code> ã€‚</p>
<p><a href="https://developer.apple.com/documentation/os/1646466-os_unfair_lock_lock">os_unfair_lock_lock</a></p>
<h2 id="å„ä¸ªé”åœ¨-swift-ä¸Šçš„æ€§èƒ½æµ‹è¯•"><a class="header" href="#å„ä¸ªé”åœ¨-swift-ä¸Šçš„æ€§èƒ½æµ‹è¯•">å„ä¸ªé”åœ¨ Swift ä¸Šçš„æ€§èƒ½æµ‹è¯•</a></h2>
<p><a href="https://gist.github.com/steipete/36350a8a60693d440954b95ea6cbbafc">Updated for Xcode 8, Swift 3; added os_unfair_lock</a></p>
<p>è¿™é‡Œæœ‰ä¸ªé”çš„æ€§èƒ½æµ‹è¯•ï¼Œå¦‚æœåªéœ€è¦æ”¯æŒåˆ° iOS10 ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>os_unfair_lock_s</code> æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œ <code>OSSpinLock</code> æ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯æœ‰ä¼˜å…ˆçº§åè½¬çš„é—®é¢˜ï¼š</p>
<p>å¦‚æœéœ€è¦æ”¯æŒ iOS10 ä»¥ä¸‹é‚£ä¹ˆä¿¡å·é‡æˆ–è€… <code>pthread_mutex</code> åœ¨æ€§èƒ½ä¸Šè¡¨ç°æœ€å¥½ã€‚å¦‚æœéœ€è¦æ”¯æŒ <code>Linux</code> å¹³å°å¯ä»¥é€‰æ‹© <code>pthread_mutex</code> ã€‚</p>
<p>å…¶ä½™çš„ <code>NSLock</code> ï¼Œ <code>DispatchQueue</code> å’Œ <code>@Syncronized</code> æ€§èƒ½éƒ½è¾ƒå·®ï¼Œå› ä¸ºè‹¹æœåœ¨é‡Œé¢åšäº†ä¸å°‘å®¹é”™å¤„ç†å’Œè¿›è¡Œä¸€äº›å…¨å±€è®°å½•ï¼ˆ <code>@Syncronized</code> ï¼‰</p>
<h2 id="locks-thread-safety-and-swift"><a class="header" href="#locks-thread-safety-and-swift">Locks, Thread Safety, and Swift</a></h2>
<p><a href="https://www.mikeash.com/pyblog/friday-qa-2017-10-27-locks-thread-safety-and-swift-2017-edition.html">mikeash.com: Friday Q&amp;A 2017-10-27: Locks, Thread Safety, and Swift: 2017 Edition</a></p>
<p>é”æ˜¯ä¸€ä¸ªç¡®ä¿åœ¨åŒä¸€æ—¶æœºå†…åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ç‰¹å®šåŒºé—´å†…ä»£ç çš„æœºåˆ¶ï¼Œç¡®ä¿äº†å¤šçº¿ç¨‹è®¿é—®å¯å˜æ•°æ®æ—¶çš„ä¸€è‡´æ€§ã€‚é”æœ‰ä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼š</p>
<ol>
<li>çº¿ç¨‹ç­‰å¾…é”æ—¶ä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè·å–åˆ°é”åå†å”¤é†’ï¼›</li>
<li>çº¿ç¨‹ç­‰å¾…é”æ—¶ä¼šä¸€ç›´å¿™ç­‰ï¼Œç›´åˆ°è·å–é”ï¼Œåœ¨ç­‰å¾…æ—¶é—´è¾ƒçŸ­æ—¶ä¼šæ›´æœ‰æ•ˆç‡ï¼Œä½†æ˜¯ä¼šæµªè´¹ CPU æ—¶é—´ï¼›</li>
<li>è¯»å†™é”ï¼Œæ”¯æŒå¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶è¿›å…¥åŒä¸€åŒºé—´ï¼Œä½†æ˜¯åªèƒ½æ”¯æŒä¸€ä¸ªå†™çº¿ç¨‹è¿›è¡Œå†™æ•°æ®ï¼›</li>
<li>é€’å½’é”ï¼Œæ”¯æŒåŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€é”ã€‚</li>
</ol>
<p>ç›¸å…³ API ï¼š</p>
<ol>
<li><code>pthread_mutex_t</code> äº’æ–¥é”ï¼Œæ”¯æŒé…ç½®ä¸ºé€’å½’é”ï¼›</li>
<li><code>pthread_rwlock_t</code> äº’æ–¥çš„è¯»å†™é”ï¼›</li>
<li><code>DispatchQueue</code> å¯ä»¥æ´¾å‘é˜»å¡çš„ <code>block</code> ï¼Œç»“åˆå¹¶å‘é˜Ÿåˆ—å’Œ <code>barrier blocks</code> å®ç°è¯»å†™é”ï¼Œä¹Ÿæ”¯æŒå¼‚æ­¥æ´¾å‘ï¼›</li>
<li><code>OperationQueue</code> æ”¯æŒçš„åŠŸèƒ½å’Œ <code>DispatchQueue</code> ç±»ä¼¼ï¼›</li>
<li><code>NSLock</code> æ˜¯ Objective-C å±‚çº§çš„é”ï¼Œ <code>NSRecursiveLock</code> ä¸ºæ”¯æŒé€’å½’çš„é”ï¼›</li>
<li><code>os_unfair_lock</code> æ˜¯æ›´åº•å±‚çš„é”ï¼›</li>
<li><code>@synchronized</code> ä¸º Objective-C æä¾›çš„è¯­è¨€ç‰¹æ€§ã€‚</li>
</ol>
<p><code>pthread</code> åœ¨åˆå§‹åŒ–æ—¶éœ€è¦å¤šæ³¨æ„ä¸‹ï¼Œéœ€è¦é€šè¿‡ <code>pthread</code> æä¾›çš„æ–¹æ³• <code>pthread_mutex_init</code> æˆ–è€… <code>pthread_rwlock_init</code> è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<pre><code class="language-c">var mutex = pthread_mutex_t()
pthread_mutex_init(&amp;mutex, nil)
</code></pre>
<h3 id="å€¼ç±»å‹"><a class="header" href="#å€¼ç±»å‹">å€¼ç±»å‹</a></h3>
<p><code>phtread_mutex_t</code> ï¼Œ <code>pthread_rwlock_t</code> å’Œ <code>os_unfair_lock</code> éƒ½æ˜¯å€¼ç±»å‹ã€‚å¦‚æœä½¿ç”¨ <code>=</code> è¿›è¡Œèµ‹å€¼ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œå€¼æ‹·è´ï¼Œä½†æ˜¯è¿™äº›é”ç±»å‹å¹¶ä¸æ”¯æŒæ‹·è´ã€‚å¦‚æœå¯¹ <code>pthread</code> ç±»å‹è¿›è¡Œæ‹·è´ï¼Œæ‹·è´å¾—åˆ°çš„å€¼æ˜¯ä¸å¯ç”¨çš„ï¼Œä¼šåœ¨ä½¿ç”¨æ—¶è§¦å‘å´©æºƒã€‚ <code>pthread</code> å‡½æ•°ä¼šå‡è®¾ <code>pthread</code> ç±»å‹åœ¨åˆå§‹åŒ–æ—¶æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œæ‰€ä»¥æ‹·è´åˆ°åˆ«çš„å†…å­˜åœ°å€å¹¶ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ <code>os_unfair_lock</code> ä¸ä¼šå´©æºƒï¼Œä½†æ˜¯ä¼šå¾—åˆ°å¦å¤–ä¸€ä¸ªé”ã€‚</p>
<h3 id="å¦‚ä½•é€‰æ‹©å¯¹åº”çš„-lock-api"><a class="header" href="#å¦‚ä½•é€‰æ‹©å¯¹åº”çš„-lock-api">å¦‚ä½•é€‰æ‹©å¯¹åº”çš„ Lock API</a></h3>
<p><code>DispatchQueue</code> æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ï¼Œæœ‰ç€å‹å¥½çš„ï¼Œæ›´åŠ  Swift çš„ API ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå„ç§å„æ ·çš„ç‰¹æ€§ã€‚ä½†æ˜¯ <code>DispatchQueue</code> ä¹Ÿä¸æ˜¯å®Œç¾çš„ï¼Œåœ¨å†…å­˜ä¸­ï¼Œé˜Ÿåˆ—ä¼šä½œä¸ºä¸€ä¸ªå¯¹è±¡æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸€äº›æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚åŒæ—¶ä¹Ÿä¸æ”¯æŒæ¡ä»¶å˜é‡æˆ–è€…é€’å½’ã€‚</p>
<p><code>os_unfair_lock</code> åœ¨å¯¹æ€§èƒ½æœ‰è¾ƒé«˜è¿½æ±‚å’Œä¸éœ€è¦ä¸€äº›é«˜çº§ç‰¹æ€§æ—¶æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å®ƒçš„å®ç°ç›¸å½“äºä¸€ä¸ª 32-bit çš„æ•´æ•°ï¼Œæ‰€ä»¥æ€§èƒ½å¼€é”€æå°ã€‚ä½†æ˜¯æ­£å¦‚å®ƒåå­—æ‰€è¯´çš„é‚£æ ·ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å…¬å¹³çš„é”ï¼Œå®ƒä¸ä¼šç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æœºä¼šæ¥è·å–é”ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æŸä¸ªçº¿ç¨‹ä¼šè¿…é€Ÿåœ°é‡Šæ”¾å’Œè·å–é”ï¼Œè€Œå…¶å®ƒçº¿ç¨‹åˆ™ä¸€ç›´åœ¨ç­‰å¾…ã€‚</p>
<p><code>pthread_mutex</code> åˆ™ä½äºä¸¤è€…ä¸­é—´ï¼Œå®ƒæ¯” <code>os_unfair_lock</code> è€ƒè™‘å¾—æ›´å¤šï¼Œå ç”¨å†…å­˜ä¸º 64 bytes ï¼Œåœ¨è‹¹æœçš„å®ç°ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¬å¹³çš„é”ã€‚</p>
<p><code>pthread_rwlock</code> æä¾›äº†ä¸€ä¸ªè¯»å†™é”ï¼Œä½¿ç”¨äº† 200 bytes ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›æ›´å¤šçš„ç‰¹æ€§ã€‚</p>
<p><code>NSLock</code> åŸºäº <code>pthread_mutex</code> è¿›è¡Œå°è£…ï¼Œå¦‚æœè¯´ä½ ä¸æƒ³æ‰‹åŠ¨ç®¡ç† <code>phread_mutex</code> çš„åˆå§‹åŒ–å’Œé”€æ¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>NSLock</code> ã€‚</p>
<p><code>OperationQueue</code> æä¾›äº†ä¾èµ–ç®¡ç†ã€‚</p>
<p>ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ <code>DispatchQueue</code> ï¼Œå¯¹æ€§èƒ½æœ‰è¿½æ±‚æ—¶å¯ä»¥ä½¿ç”¨ <code>os_unfair_lock</code> ï¼Œåªæœ‰å°‘æ•°æƒ…å†µæ‰éœ€è¦è€ƒè™‘å…¶å®ƒé”ã€‚</p>
<p>Swift æ²¡æœ‰ç”¨äºçº¿ç¨‹åŒæ­¥çš„è¯­è¨€å·¥å…·ï¼Œä½†æ˜¯é”çš„ API å¼¥è¡¥äº†è¿™ä¸€ç‚¹ã€‚ GCD ä¾ç„¶æ˜¯ Apple çš‡å† ä¸Šçš„æ˜ç ä¹‹ä¸€ã€‚è™½ç„¶è¯´æˆ‘ä»¬æ²¡æœ‰ <code>@synchronized</code> æˆ–è€…åŸå­å±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<h2 id="ios-locks"><a class="header" href="#ios-locks">iOS Locks</a></h2>
<p><a href="https://github.com/bestswifter/blog/blob/master/articles/ios-lock.md">blog/ios-lock.md at master Â· bestswifter/blog</a></p>
<p>è‡ªæ—‹é”ä¼ªä»£ç ï¼š</p>
<pre><code class="language-cpp">bool lock = false; // ä¸€å¼€å§‹æ²¡æœ‰é”ä¸Šï¼Œä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥ç”³è¯·é”
do {
    while(lock); // å¦‚æœ lock ä¸º true å°±ä¸€ç›´æ­»å¾ªç¯ï¼Œç›¸å½“äºç”³è¯·é”
    lock = true; // æŒ‚ä¸Šé”ï¼Œè¿™æ ·åˆ«çš„çº¿ç¨‹å°±æ— æ³•è·å¾—é”
        Critical section  // ä¸´ç•ŒåŒº
    lock = false; // ç›¸å½“äºé‡Šæ”¾é”ï¼Œè¿™æ ·åˆ«çš„çº¿ç¨‹å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒº
        Reminder section // ä¸éœ€è¦é”ä¿æŠ¤çš„ä»£ç         
}
</code></pre>
<p>åŸå­æ“ä½œéœ€è¦ç”±ç¡¬ä»¶æ”¯æŒï¼Œåœ¨æ‰§è¡Œæ—¶ä¼šæŠŠæ€»çº¿é”ä½ï¼Œä½¿å¾—å…¶å®ƒ CPU ä¸èƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼š</p>
<pre><code class="language-cpp">bool test_and_set (bool *target) {
    bool rv = *target; 
    *target = TRUE; 
    return rv;
}
</code></pre>
<p>ä¹Ÿä»‹ç»äº†å…¶å®ƒé”çš„ç›¸å…³åŸç†ã€‚</p>
<h2 id="ios-ä¸­çš„é‚£äº›é”"><a class="header" href="#ios-ä¸­çš„é‚£äº›é”">iOS ä¸­çš„é‚£äº›é”</a></h2>
<p><a href="https://juejin.cn/post/6844904167010467854">iOSæ¢ç´¢ ç»†æ•°iOSä¸­çš„é‚£äº›é”</a></p>
<h3 id="atomic-çš„åŸç†"><a class="header" href="#atomic-çš„åŸç†"><code>atomic</code> çš„åŸç†ï¼š</a></h3>
<pre><code class="language-cpp">static inline void reallySetProperty(id self, SEL _cmd, id newValue, ptrdiff_t offset, bool atomic, bool copy, bool mutableCopy)
{
    if (offset == 0) {
        object_setClass(self, newValue);
        return;
    }

    id oldValue;
    id *slot = (id*) ((char*)self + offset);

    if (copy) {
        newValue = [newValue copyWithZone:nil];
    } else if (mutableCopy) {
        newValue = [newValue mutableCopyWithZone:nil];
    } else {
        if (*slot == newValue) return;
        newValue = objc_retain(newValue);
    }

    if (!atomic) {
        oldValue = *slot;
        *slot = newValue;
    } else {
        spinlock_t&amp; slotlock = PropertyLocks[slot];
        slotlock.lock();
        oldValue = *slot;
        *slot = newValue;        
        slotlock.unlock();
    }

    objc_release(oldValue);
}
</code></pre>
<p>å¦‚æœä½¿ç”¨äº† <code>atomic</code> è¿›è¡Œå£°æ˜ï¼Œé‚£ä¹ˆå°±ä¼šæ”¹ç”¨ <code>spinlock_t</code> æ¥è¿›è¡ŒåŠ é”ï¼Œè€Œ <code>spinlock_t</code> åˆ™æ˜¯ä½¿ç”¨ <code>os_unfair_lock</code> å®ç°ï¼š</p>
<pre><code class="language-cpp">using spinlock_t = mutex_tt&lt;LOCKDEBUG&gt;;

class mutex_tt : nocopy_t {
    os_unfair_lock mLock;
    ...
}
</code></pre>
<p>ä¸”ç”±äº <code>atomic</code> çš„æ€§èƒ½é—®é¢˜ï¼Œåœ¨ iOS ä¸ŠåŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨ <code>nonatomic</code> æ¥è¿›è¡Œå£°æ˜ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../iDev/Multithreading/thread.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../iDev/Multithreading/RunLoop.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../iDev/Multithreading/thread.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../iDev/Multithreading/RunLoop.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
